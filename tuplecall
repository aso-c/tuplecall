//
// Calling function with parameters,
// packaged in a tuple.
//
// tuplecall
// Header file
//
// author: Solomatov A.A. (aso)
// ver.  : v.1.0.5
// date  : 12.07.22.
//
// Copyright (c) 2022 Andrey "aso" Solomatov
// This project is licensed under the terms of the MIT license.


//
// Usage:
//
//#include <functional>
//      . . .
//
//#include <tuplecall>
//      . . .
//
//
//    aso::simple_tuplecall(exec, items);
//
// or, if needed:
//
//    aso::Tuple<Type_List>::simple_call(exec, items);
//
// or
//
//    aso::Tuple<Type_List>::simple::call(exec, items);
//
//

#ifndef __TUPLECALL_ASO__
#define __TUPLECALL_ASO__


namespace aso
{

    template <typename ...ParamTypes>
    class Tuple
    {
    public:

	template <typename FnType>
	static auto simple_call( FnType fn, const std::tuple<ParamTypes...>& argstuple) -> typename std::result_of<FnType(ParamTypes...)>::type
	{
	    return simple::call(fn, argstuple);
	};

    	class simple
    	{
    	public:

    	    template <typename FnType>
    	    static auto call(FnType fn, const std::tuple<ParamTypes...>& argstuple) -> typename std::result_of<FnType(ParamTypes...)>::type;

    	}; /* simple */


    private:

	template <std::size_t limit, std::size_t... params>
	class caller
	{
	public:

	    template <typename FnType>
	    static auto invoke(FnType fn, const std::tuple<ParamTypes...>& argstuple) -> typename std::result_of<FnType(ParamTypes...)>::type
	    {
		return caller<limit-1, limit-1, params...>::invoke(fn, argstuple); };

	}; /* caller */

	template <std::size_t... params>
	class caller<0, params...>
	{
	public:

	    template <typename FnType>
	    static auto invoke(FnType& fn, const std::tuple<ParamTypes...>& argstuple) -> typename std::result_of<FnType(ParamTypes...)>::type
	    {
		return fn(std::get<params>(argstuple)...); };

	}; /* caller<0, ParamTypes...> */

    }; /* Tuple */


template <typename ...ParamTypes>
template <typename FnType>
inline auto Tuple<ParamTypes...>::simple::call(FnType fn, const std::tuple<ParamTypes...>& argstuple) -> typename std::result_of<FnType(ParamTypes...)>::type {
	return caller<sizeof...(ParamTypes)>::invoke(fn, argstuple); };



    template <typename FnT, typename ...ParamTypes>
    inline auto simple_tuplecall(FnT fn, const std::tuple<ParamTypes...>& argstuple) -> typename std::result_of<FnT(ParamTypes...)>::type
    {
	return Tuple<ParamTypes...>::simple_call(fn, argstuple);
    }; /* simple_tuplecall */

}; // namespace aso

#endif // __TUPLECALLER_ASO__

//--[ End of file tuplecall ]----------------------------------------------------------------------
